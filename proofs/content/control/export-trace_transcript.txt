# CONTROL — export-trace
# Query: Which file defines the createApp function? What does it depend on? Trace the full dependency chain.
# Duration: 61s
# Tool calls: 17
# Files read: 15
# Tokens: 223746 in / 3319 out
# Cost: $0.1070
# FMM discovered: False
# Manifest used: False

## Tool Call Sequence

  1. Grep(function createApp|const createApp|export.*createApp)
  2. Grep(createApp)
  3. Read(src/index.ts)
  4. Read(src/config/app.ts)
  5. Read(src/api/routes/auth.ts)
  6. Read(src/api/routes/users.ts)
  7. Read(src/middleware/rateLimit.ts)
  8. Read(src/auth/login.ts)
  9. Read(src/auth/signup.ts)
  10. Read(src/auth/jwt.ts)
  11. Read(src/middleware/auth.ts)
  12. Read(src/api/models/user.ts)
  13. Read(src/auth/types.ts)
  14. Read(src/auth/password.ts)
  15. Read(src/services/audit.ts)
  16. Read(src/services/email.ts)
  17. Read(src/utils/id.ts)

## LLM Response

I'll help you find the `createApp` function and trace its dependency chain. Let me start by searching for it in the codebase.
Great! The `createApp` function is defined in `src/index.ts`. Let me read that file to see what it does and what it depends on.
Perfect! Now let me trace the full dependency chain. The `createApp` function depends on:

1. `config` and `validateConfig` from `./config/app`
2. `getAuthRoutes` from `./api/routes/auth`
3. `getUserRoutes` from `./api/routes/users`
4. `rateLimiter` from `./middleware/rateLimit`

Let me read each of these files to trace the complete dependency chain:
Now let me continue tracing the dependencies of these files:
Let me continue tracing the remaining dependencies:
Perfect! Now I have traced the complete dependency chain. Let me provide you with a comprehensive analysis:

## **Complete Dependency Chain for `createApp` Function**

### **Main File**
**`src/index.ts`** - Defines the `createApp` function

---

### **Direct Dependencies (Level 1)**

1. **`src/config/app.ts`**
   - Exports: `config`, `validateConfig`, `AppConfig` interface
   - No dependencies (leaf node - only uses Node.js `process.env`)

2. **`src/api/routes/auth.ts`**
   - Exports: `getAuthRoutes`
   - Dependencies: ↓

3. **`src/api/routes/users.ts`**
   - Exports: `getUserRoutes`
   - Dependencies: ↓

4. **`src/middleware/rateLimit.ts`**
   - Exports: `rateLimiter`, `authRateLimiter`
   - Dependencies: ↓

---

### **Level 2 Dependencies**

#### From `src/api/routes/auth.ts`:
- **`src/auth/login.ts`** → `authenticateUser`, `validateSession`
- **`src/auth/signup.ts`** → `registerUser`, `validateSignupData`
- **`src/auth/jwt.ts`** → `refreshToken`
- **`src/middleware/auth.ts`** → `authMiddleware`, `AuthenticatedRequest`, `Response`
- **`src/middleware/rateLimit.ts`** → `authRateLimiter`

#### From `src/api/routes/users.ts`:
- **`src/api/models/user.ts`** → `findUserById`, `listUsers`, `updateUser`, `deleteUser`
- **`src/middleware/auth.ts`** → `authMiddleware`, `requireRole`, `AuthenticatedRequest`, `Response`

#### From `src/middleware/rateLimit.ts`:
- **`src/middleware/auth.ts`** → `AuthenticatedRequest`, `Response` (types only)

---

### **Level 3 Dependencies**

#### From `src/auth/login.ts`:
- **`src/auth/types.ts`** → Type definitions (leaf node)
- **`src/auth/jwt.ts`** → `generateToken`
- **`src/api/models/user.ts`** → `findUserByEmail`
- **`src/auth/password.ts`** → `verifyPassword`
- **`src/services/audit.ts`** → `logAuthEvent`

#### From `src/auth/signup.ts`:
- **`src/auth/types.ts`** → Type definitions
- **`src/auth/jwt.ts`** → `generateToken`
- **`src/api/models/user.ts`** → `createUser`, `findUserByEmail`
- **`src/auth/password.ts`** → `hashPassword`
- **`src/services/audit.ts`** → `logAuthEvent`
- **`src/services/email.ts`** → `sendWelcomeEmail`

#### From `src/auth/jwt.ts`:
- **`src/config/app.ts`** → `config` (circular reference back to Level 1)
- **`src/auth/types.ts`** → `UserPayload` type

#### From `src/middleware/auth.ts`:
- **`src/auth/jwt.ts`** → `verifyToken`
- **`src/auth/types.ts`** → `UserPayload`, `UserRole`

#### From `src/api/models/user.ts`:
- **`src/auth/types.ts`** → `UserRole`
- **`src/utils/id.ts`** → `generateId`

---

### **Level 4 Dependencies (Leaf Nodes)**

#### From `src/auth/password.ts`:
- **`src/config/app.ts`** → `config`

#### From `src/services/audit.ts`:
- No dependencies (leaf node)

#### From `src/services/email.ts`:
- No dependencies (leaf node)

#### From `src/utils/id.ts`:
- No dependencies (leaf node)

#### From `src/auth/types.ts`:
- No dependencies (leaf node - type definitions only)

---

### **Complete Dependency Tree Visualization**

```
createApp (src/index.ts)
├── config (src/config/app.ts) [LEAF]
├── validateConfig (src/config/app.ts) [LEAF]
├── getAuthRoutes (src/api/routes/auth.ts)
│   ├── authenticateUser (src/auth/login.ts)
│   │   ├── types (src/auth/types.ts) [LEAF]
│   │   ├── generateToken (src/auth/jwt.ts)
│   │   │   ├── config (src/config/app.ts) [SHARED]
│   │   │   └── UserPayload (src/auth/types.ts) [SHARED]
│   │   ├── findUserByEmail (src/api/models/user.ts)
│   │   │   ├── UserRole (src/auth/types.ts) [SHARED]
│   │   │   └── generateId (src/utils/id.ts) [LEAF]
│   │   ├── verifyPassword (src/auth/password.ts)
│   │   │   └── config (src/config/app.ts) [SHARED]
│   │   └── logAuthEvent (src/services/audit.ts) [LEAF]
│   ├── validateSession (src/auth/login.ts) [SHARED]
│   ├── registerUser (src/auth/signup.ts)
│   │   ├── types (src/auth/types.ts) [SHARED]
│   │   ├── generateToken (src/auth/jwt.ts) [SHARED]
│   │   ├── createUser (src/api/models/user.ts) [SHARED]
│   │   ├── findUserByEmail (src/api/models/user.ts) [SHARED]
│   │   ├── hashPassword (src/auth/password.ts)
│   │   │   └── config (src/config/app.ts) [SHARED]
│   │   ├── logAuthEvent (src/services/audit.ts) [SHARED]
│   │   └── sendWelcomeEmail (src/services/email.ts) [LEAF]
│   ├── validateSignupData (src/auth/signup.ts) [SHARED]
│   ├── refreshToken (src/auth/jwt.ts) [SHARED]
│   ├── authMiddleware (src/middleware/auth.ts)
│   │   ├── verifyToken (src/auth/jwt.ts) [SHARED]
│   │   └── types (src/auth/types.ts) [SHARED]
│   └── authRateLimiter (src/middleware/rateLimit.ts)
│       └── AuthenticatedRequest/Response (src/middleware/auth.ts) [SHARED]
├── getUserRoutes (src/api/routes/users.ts)
│   ├── findUserById (src/api/models/user.ts) [SHARED]
│   ├── listUsers (src/api/models/user.ts) [SHARED]
│   ├── updateUser (src/api/models/user.ts) [SHARED]
│   ├── deleteUser (src/api/models/user.ts) [SHARED]
│   ├── authMiddleware (src/middleware/auth.ts) [SHARED]
│   └── requireRole (src/middleware/auth.ts)
│       ├── verifyToken (src/auth/jwt.ts) [SHARED]
│       └── types (src/auth/types.ts) [SHARED]
└── rateLimiter (src/middleware/rateLimit.ts)
    └── AuthenticatedRequest/Response (src/middleware/auth.ts) [SHARED]
```

---

### **Summary**

**Total unique files in dependency chain: 15 files**

1. `src/index.ts` (main)
2. `src/config/app.ts`
3. `src/api/routes/auth.ts`
4. `src/api/routes/users.ts`
5. `src/middleware/rateLimit.ts`
6. `src/middleware/auth.ts`
7. `src/auth/login.ts`
8. `src/auth/signup.ts`
9. `src/auth/jwt.ts`
10. `src/auth/password.ts`
11. `src/auth/types.ts`
12. `src/api/models/user.ts`
13. `src/services/audit.ts`
14. `src/services/email.ts`
15. `src/utils/id.ts`

**Key observations:**
- The `config` from `src/config/app.ts` is used throughout the application (shared dependency)
- Authentication logic is heavily interconnected between JWT, password handling, and user models
- Type definitions in `src/auth/types.ts` are used across multiple modules
- The application has clear separation of concerns: routes, auth, middleware, models, services, and utils